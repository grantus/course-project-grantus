# NFR.md — Таблица требований безопасности

| ID                                                                    | Название                    | Описание                                                                                         | Метрика/Порог                                     | Проверка (чем/где)                                  | Компонент      | Приоритет |
|-----------------------------------------------------------------------|-----------------------------|--------------------------------------------------------------------------------------------------|---------------------------------------------------|------------------------------------------------------|----------------|-----------|
| [NFR-01](https://github.com/grantus/course-project-grantus/issues/2)  | Обязательная аутентификация | Все защищённые эндпоинты требуют действительного токена (кроме `/healthz`).                      | 100% защищённых эндпоинтов требуют Auth           | Контракт-тесты Pytest + e2e                          | api/auth       | High      |
| [NFR-02](https://github.com/grantus/course-project-grantus/issues/3)  | Авторизация «owner-only»    | Пользователь может работать только со своими Objective/KeyResult.                                | 100% CRUD операций применяют owner-check          | Unit + e2e (negative/positive)                       | api/authz      | High      |
| [NFR-03](https://github.com/grantus/course-project-grantus/issues/4)  | Хранение паролей            | Хэширование только Argon2id с параметрами не ниже заданных.                                      | t≥3, m≥256MB, p≥1                                  | Конфиг + unit-тест                                   | auth           | High      |
| [NFR-04](https://github.com/grantus/course-project-grantus/issues/5)  | Валидация периода           | `period` (дедлайн) не в прошлом и не далее чем +24 месяца от «сегодня».                          | 100% некорректных дат → 422                       | Unit-тесты FastAPI (pydantic)                        | api/validation | High      |
| [NFR-05](https://github.com/grantus/course-project-grantus/issues/6)  | Формат ошибок RFC7807       | Ответы об ошибках в Problem Details + `correlation_id`, без PII.                                 | 100% ошибок RFC7807 + корел.-ID                   | Контракт-тесты + e2e                                 | api            | Medium    |
| [NFR-06](https://github.com/grantus/course-project-grantus/issues/7)  | Rate limiting               | Записьные операции ограничены по токену/пользователю.                                            | 100 req/min на токен; превышение → 429            | e2e + нагрузочный smoke                              | api/gateway    | Medium    |
| [NFR-07](https://github.com/grantus/course-project-grantus/issues/8)  | Логирование событий         | Логируются security-события (login, create/update/delete, доступ запрещён).                      | ≥ 95% покрытие ключевых событий                   | Unit + e2e; проверка по логам CI                     | audit/logging  | Medium    |
| [NFR-08](https://github.com/grantus/course-project-grantus/issues/9)  | Уязвимости зависимостей     | High/Critical устраняются оперативно.                                                            | SLA: ≤ 7 дней с момента детекта                   | CI отчёт pip-audit/SBOM                              | build          | High      |
| [NFR-09](https://github.com/grantus/course-project-grantus/issues/10) | Аудит и трассировка действий | Все CRUD/Auth события логируются (allow/deny/error), без PII; проверяется полнота логов. | ≥95% ключевых событий фиксируются в audit log | Логи CI и e2e-тесты audit_log | audit/logging | Medium |
| [NFR-10](https://github.com/grantus/course-project-grantus/issues/11) | Защита CI/CD цепочки поставки | Pipeline формирует SBOM (`cyclonedx-bom`), выполняет `pip-audit`, блокирует релиз при уязвимостях High/Crit. | 100% сборок содержат SBOM и отчёт `pip-audit` | CI workflow (`ci.yml`) | build/ci | Medium |
